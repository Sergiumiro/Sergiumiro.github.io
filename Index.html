<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>–ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏</title>
  <style>
    :root {
      --picker-max-width: 640px;
      --item-height: 64px;
    }

    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:#f9fafb;
      color:#111;
      display:flex;
      flex-direction:column;
      height:100vh;
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      display:flex;
      justify-content:flex-end;
      padding:12px;
      background:#fff;
      border-bottom:1px solid #e6e6e6;
      z-index:5;
    }

    #settingsBtn{ cursor:pointer; font-size:20px; }

    .screen{
      flex:1;
      display:none;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      text-align:center;
      padding:18px;
      box-sizing:border-box;
    }
    .screen.active{ display:flex; }

    h2{ margin:0 0 18px; font-size:20px; }

    /* –ü–∏–∫–µ—Ä */
    .picker{
      width:100%;
      max-width:var(--picker-max-width);
      height:320px;
      perspective:1800px; /* —É–≤–µ–ª–∏—á–µ–Ω–æ, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –∏—Å–∫–∞–∂–µ–Ω–∏—è */
      position:relative;
      overflow:hidden;
      touch-action:none;
      box-sizing:border-box;
    }

    .wheel{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotateX(0deg);
      transform-style:preserve-3d;
      width:100%;
      height:100%;
      pointer-events:none; /* –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ .picker */
    }

    /* –ö–∞–∂–¥—ã–π "—Å–ø–ª–∞–π—Å" –∫–æ–ª–µ—Å–∞: */
    .item{
      position:absolute;
      left:0;
      top:50%;
      width:100%;
      height:var(--item-height);
      margin-top: calc(var(--item-height) / -2); /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
      transform-style:preserve-3d;
      pointer-events:none;
    }

    /* –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±—ë—Ä—Ç–∫–∞: –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –ø–æ–≤–æ—Ä–æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è,
       —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–≤–∞–ª—Å—è —Ä–æ–≤–Ω—ã–º –∏ –Ω–µ –∏—Å–∫–∞–∂–µ–Ω 3D-–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–æ–π */
    .item-inner{
      display:flex;
      align-items:center;
      justify-content:center;
      width:100%;
      height:100%;
      padding:0 18px;
      box-sizing:border-box;
      text-align:center;
      word-break:break-word;
      white-space:normal;
      line-height:1.2;
      font-size:18px;
      color:#444;
      backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
      transform-style:preserve-3d;
      pointer-events:auto; /* —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
    }

    .item.active .item-inner{
      font-size:20px;
      font-weight:600;
      color:#007aff;
      text-shadow:0 1px 3px rgba(0,122,255,0.18);
    }

    /* –ü–æ–ª–æ—Å–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è */
    .picker::after{
      content:"";
      position:absolute;
      left:0; right:0;
      top:50%;
      height:var(--item-height);
      margin-top: calc(var(--item-height) / -2);
      border-top:2px solid rgba(0,122,255,0.12);
      border-bottom:2px solid rgba(0,122,255,0.12);
      pointer-events:none;
      z-index:2;
    }

    #resultText{
      max-width:900px;
      width:100%;
      padding:12px 18px;
      box-sizing:border-box;
      font-size:24px;
      font-weight:600;
      text-align:center;
      word-break:break-word;
      white-space:normal;
      line-height:1.3;
      opacity:0;
      transform:scale(0.98);
      transition:opacity .6s ease, transform .6s ease;
    }
    .fade-in{ opacity:1 !important; transform:scale(1) !important; }

    button{
      margin-top:18px;
      padding:10px 18px;
      border-radius:10px;
      border:0;
      background:#007aff;
      color:#fff;
      font-size:16px;
      cursor:pointer;
    }
    button:hover{ background:#0061d6; }

    /* –ú–æ–¥–∞–ª–∫–∞ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏) */
    #settingsModal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      align-items:center;
      justify-content:center;
      z-index:20;
    }
    .modal-content{
      background:#fff;
      padding:18px;
      width:360px;
      max-height:80vh;
      overflow:auto;
      border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,0.15);
    }
    textarea{ width:100%; height:110px; box-sizing:border-box; padding:8px; border-radius:8px; border:1px solid #ddd; resize:vertical; }
    .divider{ height:1px; background:#eee; margin:14px 0; }

    /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç–∫–ª–∏–∫ –¥–ª—è —Ç–∞—á-–æ–±–ª–∞—Å—Ç–∏ */
    .picker:active { cursor:grabbing; }
  </style>
</head>
<body>
  <header>
    <div id="settingsBtn">‚öôÔ∏è</div>
  </header>

  <div class="screen active" id="screen1">
    <h2>–í—ã–±–µ—Ä–∏ –º–µ—Å—Ç–æ</h2>
    <div class="picker" id="picker1"><div class="wheel" id="wheel1"></div></div>
  </div>

  <div class="screen" id="screen2">
    <h2>–í—ã–±–µ—Ä–∏ –∑–∞–Ω—è—Ç–∏–µ</h2>
    <div class="picker" id="picker2"><div class="wheel" id="wheel2"></div></div>
  </div>

  <div class="screen" id="screen3">
    <h2>–ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏</h2>
    <div id="resultText"></div>
    <button id="restart">–ó–∞–Ω–æ–≤–æ</button>
  </div>

  <div id="settingsModal">
    <div class="modal-content">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–∏</h3>
      <h4>–°–ø–∏—Å–æ–∫ –º–µ—Å—Ç</h4>
      <textarea id="listInput1"></textarea>
      <div style="margin-top:8px">
        <button id="saveBtn1">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="resetBtn1" style="margin-left:8px">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
      <div class="divider"></div>
      <h4>–°–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç–∏–π</h4>
      <textarea id="listInput2"></textarea>
      <div style="margin-top:8px">
        <button id="saveBtn2">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="resetBtn2" style="margin-left:8px">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

  <script>
    const defaultItems1 = [
      "üåá –ö—Ä—ã—à–∞ –≤—ã—Å–æ—Ç–Ω–æ–≥–æ –¥–æ–º–∞ —Å –≤–∏–¥–æ–º –Ω–∞ –∑–∞–∫–∞—Ç",
      "üå≥ –ü—Ä–æ–≥—É–ª–∫–∞ –ø–æ –ø–∞—Ä–∫—É —Å –∫–æ—Ñ–µ",
      "üåä –ü–æ–µ–∑–¥–∫–∞ –Ω–∞ –º–æ—Ä–µ –∏–ª–∏ –Ω–∞–±–µ—Ä–µ–∂–Ω—É—é",
      "üåÜ –ú–∞–ª–µ–Ω—å–∫–∏–π –≥–æ—Ä–æ–¥ —Ä—è–¥–æ–º –¥–ª—è –º–∏–Ω–∏-–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è",
      "üèûÔ∏è –ü–æ—Ö–æ–¥ –≤ –ª–µ—Å –∏–ª–∏ –ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ —Ç—Ä–æ–ø–∞–º",
      "üçΩÔ∏è –£—é—Ç–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å —Ç–µ—Ä—Ä–∞—Å–æ–π",
      "üé¢ –ü–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤",
      "üèñÔ∏è –ü–ª—è–∂ —Å –ø–ª–µ–¥–æ–º –∏ —Ñ—Ä—É–∫—Ç–∞–º–∏",
      "üè∞ –°—Ç–∞—Ä—ã–π –∑–∞–º–æ–∫ –∏–ª–∏ —É—Å–∞–¥—å–±–∞",
      "ü™© –ö–ª—É–± –∏–ª–∏ –ª–∞—É–Ω–∂"
    ];

    const defaultItems2 = [
      "üö∂ –ü—Ä–æ–≥—É–ª–∫–∞",
      "üì∏ –§–æ—Ç–æ—Å–µ—Å—Å–∏—è",
      "üç∑ –£–∂–∏–Ω",
      "üé¨ –ö–∏–Ω–æ",
      "üé∂ –ö–æ–Ω—Ü–µ—Ä—Ç",
      "üçï –ü–∏–∫–Ω–∏–∫",
      "üéÆ –ò–≥—Ä—ã –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–ª–∏ VR",
      "üß∫ –ó–∞–≤—Ç—Ä–∞–∫ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ",
      "üß≠ –ö–≤–µ—Å—Ç –ø–æ –≥–æ—Ä–æ–¥—É",
      "üïØÔ∏è –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä —Å –≤–∏–Ω–æ–º"
    ];

    let items1 = JSON.parse(localStorage.getItem("slotItems1")) || [...defaultItems1];
    let items2 = JSON.parse(localStorage.getItem("slotItems2")) || [...defaultItems2];

    const clickSound = document.getElementById("clickSound");

    function buildWheel(wheel, items) {
      wheel.innerHTML = "";
      // –†–∞–¥–∏—É—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã—Å–æ—Ç—ã –ø–∏–∫–µ—Ä–∞ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ–º, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–∏–ª—å–Ω—ã—Ö –∏—Å–∫–∞–∂–µ–Ω–∏–π
      const picker = wheel.parentElement;
      const pickerH = Math.max(240, picker.clientHeight || 300);
      const radius = Math.max(120, Math.round(pickerH * 0.6)); // –Ω–∞–ø—Ä–∏–º–µ—Ä 0.6 * –≤—ã—Å–æ—Ç–∞
      const angleStep = 360 / items.length;

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–¥–∏—É—Å –≤ dataset –Ω–∞ —Å–ª—É—á–∞–π –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
      wheel.dataset.radius = radius;

      items.forEach((text, i) => {
        const angle = i * angleStep;
        const el = document.createElement("div");
        el.className = "item";
        // –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å –≤—Ä–∞—â–µ–Ω–∏–µ–º –∏ –≤—ã–¥–≤–∏–∂–µ–Ω–∏–µ–º –ø–æ –æ—Å–∏ Z
        el.style.transform = `rotateX(${angle}deg) translateZ(${radius}px)`;
        // –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±—ë—Ä—Ç–∫–∞ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –ø–æ–≤–æ—Ä–æ—Ç, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–≤–∞–ª—Å—è —Ä–æ–≤–Ω—ã–º
        const inner = document.createElement("div");
        inner.className = "item-inner";
        inner.style.transform = `rotateX(${-angle}deg) translateZ(0)`;
        inner.textContent = text;
        el.appendChild(inner);
        wheel.appendChild(el);
      });

      // –ø–æ–º–µ—Ç–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç (–∏–Ω–¥–µ–∫—Å 0) –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      Array.from(wheel.children).forEach((el, idx) => el.classList.toggle("active", idx === 0));
      wheel.dataset.rotation = "0";
      wheel.style.transform = `translate(-50%,-50%) rotateX(0deg)`;
    }

    function spinWheel(wheel, velocity, items, onFinish) {
      let rotation = parseFloat(wheel.dataset.rotation || "0");
      const angleStep = 360 / items.length;
      const damping = 0.97;
      let lastNormalized = 0;

      function animate() {
        velocity *= damping;
        rotation += velocity;
        const normalized = ((rotation % 360) + 360) % 360;

        // —â–µ–ª—á–æ–∫ –∑–≤—É–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ —Å–µ–∫—Ç–æ—Ä–∞
        if (Math.abs(normalized - lastNormalized) > angleStep / 2) {
          try { clickSound.currentTime = 0; clickSound.play(); } catch(e){}
          lastNormalized = normalized;
        }

        wheel.style.transform = `translate(-50%,-50%) rotateX(${rotation}deg)`;
        wheel.dataset.rotation = rotation;

        if (Math.abs(velocity) > 0.3) {
          requestAnimationFrame(animate);
        } else {
          const index = Math.round(-rotation / angleStep) % items.length;
          const fixedIndex = (index + items.length) % items.length;
          const finalAngle = -fixedIndex * angleStep;
          wheel.style.transform = `translate(-50%,-50%) rotateX(${finalAngle}deg)`;
          wheel.dataset.rotation = finalAngle;
          Array.from(wheel.children).forEach((el, i) =>
            el.classList.toggle("active", i === fixedIndex)
          );
          onFinish?.(fixedIndex);
        }
      }
      animate();
    }

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ touch (–∏ –º—ã—à–∏)
    function enablePicker(picker, wheel, items, onSelect) {
      let startY = 0, lastY = 0, velocity = 0, lastTime = 0;
      let dragging = false;
      let currentRotation = parseFloat(wheel.dataset.rotation || "0");

      // touch
      picker.addEventListener("touchstart", e => {
        e.stopPropagation();
        dragging = true;
        startY = lastY = e.touches[0].clientY;
        lastTime = performance.now();
      }, {passive:false});

      picker.addEventListener("touchmove", e => {
        if(!dragging) return;
        e.preventDefault();
        const y = e.touches[0].clientY;
        const dy = y - lastY;
        currentRotation -= dy * 0.6; // –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
        wheel.style.transform = `translate(-50%,-50%) rotateX(${currentRotation}deg)`;
        wheel.dataset.rotation = currentRotation;
        const dt = performance.now() - lastTime || 16;
        velocity = dy / dt * 15;
        lastY = y;
        lastTime = performance.now();
      }, {passive:false});

      picker.addEventListener("touchend", e => {
        dragging = false;
        spinWheel(wheel, velocity, items, onSelect);
      });

      // mouse (drag)
      picker.addEventListener("mousedown", e => {
        e.preventDefault();
        dragging = true;
        startY = lastY = e.clientY;
        lastTime = performance.now();
      });
      window.addEventListener("mousemove", e => {
        if(!dragging) return;
        const y = e.clientY;
        const dy = y - lastY;
        currentRotation -= dy * 0.6;
        wheel.style.transform = `translate(-50%,-50%) rotateX(${currentRotation}deg)`;
        wheel.dataset.rotation = currentRotation;
        const dt = performance.now() - lastTime || 16;
        velocity = dy / dt * 15;
        lastY = y;
        lastTime = performance.now();
      });
      window.addEventListener("mouseup", e => {
        if(!dragging) return;
        dragging = false;
        spinWheel(wheel, velocity, items, onSelect);
      });
    }

    function showScreen(id){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const wheel1 = document.getElementById("wheel1");
    const wheel2 = document.getElementById("wheel2");
    buildWheel(wheel1, items1);
    buildWheel(wheel2, items2);

    let selected1 = null;

    enablePicker(document.getElementById("picker1"), wheel1, items1, i => {
      selected1 = i;
      showScreen("screen2");
    });

    enablePicker(document.getElementById("picker2"), wheel2, items2, i => {
      const selected2 = i;
      const resultText = document.getElementById("resultText");
      resultText.classList.remove("fade-in");
      resultText.textContent = `${items1[selected1]} ‚Äî ${items2[selected2]}`;
      showScreen("screen3");
      // –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => resultText.classList.add("fade-in"), 80);
    });

    document.getElementById("restart").onclick = () => {
      // —Å–Ω—è—Ç—å –∫–ª–∞—Å—Å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω
      document.getElementById("resultText").classList.remove("fade-in");
      showScreen("screen1");
    };

    // –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    const modal = document.getElementById("settingsModal");
    const listInput1 = document.getElementById("listInput1");
    const listInput2 = document.getElementById("listInput2");

    document.getElementById("settingsBtn").onclick = () => {
      modal.style.display = "flex";
      listInput1.value = items1.join("\n");
      listInput2.value = items2.join("\n");
    };
    modal.addEventListener("click", e => { if(e.target === modal) modal.style.display = "none"; });

    document.getElementById("saveBtn1").onclick = () => {
      items1 = listInput1.value.split("\n").map(x => x.trim()).filter(Boolean);
      localStorage.setItem("slotItems1", JSON.stringify(items1));
      buildWheel(wheel1, items1);
    };
    document.getElementById("saveBtn2").onclick = () => {
      items2 = listInput2.value.split("\n").map(x => x.trim()).filter(Boolean);
      localStorage.setItem("slotItems2", JSON.stringify(items2));
      buildWheel(wheel2, items2);
    };
    document.getElementById("resetBtn1").onclick = () => {
      items1 = [...defaultItems1];
      localStorage.removeItem("slotItems1");
      buildWheel(wheel1, items1);
    };
    document.getElementById("resetBtn2").onclick = () => {
      items2 = [...defaultItems2];
      localStorage.removeItem("slotItems2");
      buildWheel(wheel2, items2);
    };
  </script>
</body>
</html>
