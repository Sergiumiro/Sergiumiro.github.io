<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Telegram WebApp Slots</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    margin: 0;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    height: 100vh;
    color: #111;
    overflow: hidden;
  }
  header {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    padding: 12px;
    background: #fff;
    border-bottom: 1px solid #ddd;
    font-size: 22px;
  }
  #settingsBtn { cursor: pointer; }

  .screen {
    flex: 1;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding: 20px;
  }
  .active { display: flex; }

  h2 {
    font-size: 22px;
    margin-bottom: 20px;
    color: #111;
  }

  .slot-wrapper {
    position: relative;
    width: 100%;
    max-width: 280px;
    height: 200px;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }

  .slot-item {
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    color: #555;
    transition: all 0.2s ease;
  }
  .slot-item.active {
    font-size: 22px;
    font-weight: 600;
    color: #007aff;
  }

  .highlight {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 40px;
    margin-top: -20px;
    border-top: 2px solid #007aff;
    border-bottom: 2px solid #007aff;
    pointer-events: none;
  }

  .slot-wrapper::before, .slot-wrapper::after {
    content: "";
    position: absolute;
    left: 0; right: 0;
    height: 50%;
    pointer-events: none;
  }
  .slot-wrapper::before {
    top: 0;
    background: linear-gradient(to bottom, rgba(249,250,251,1), rgba(249,250,251,0));
  }
  .slot-wrapper::after {
    bottom: 0;
    background: linear-gradient(to top, rgba(249,250,251,1), rgba(249,250,251,0));
  }

  #resultText {
    font-size: 26px;
    font-weight: 600;
    margin-top: 20px;
  }

  button {
    padding: 12px 20px;
    font-size: 16px;
    margin-top: 20px;
    border-radius: 10px;
    border: none;
    background: #007aff;
    color: #fff;
    cursor: pointer;
  }
  button:hover { background: #005ecb; }

  /* --- –ú–æ–¥–∞–ª–∫–∞ --- */
  #settingsModal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #fff;
    padding: 20px;
    border-radius: 14px;
    width: 340px;
    max-height: 80vh;
    overflow: auto;
  }
  textarea {
    width: 100%;
    height: 100px;
    margin-top: 8px;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-family: inherit;
  }
  h4 { margin: 15px 0 5px; font-size: 16px; }
  .divider { margin: 20px 0; border-top: 1px solid #ddd; }
</style>
</head>
<body>
  <header>
    <div id="settingsBtn">‚öôÔ∏è</div>
  </header>

  <!-- –≠–∫—Ä–∞–Ω 1 -->
  <div class="screen active" id="screen1">
    <h2>–í—ã–±–æ—Ä 1</h2>
    <div class="slot-wrapper" id="wrapper1">
      <div id="slot1"></div>
      <div class="highlight"></div>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 2 -->
  <div class="screen" id="screen2">
    <h2>–í—ã–±–æ—Ä 2</h2>
    <div class="slot-wrapper" id="wrapper2">
      <div id="slot2"></div>
      <div class="highlight"></div>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 3 -->
  <div class="screen" id="screen3">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <div id="resultText"></div>
    <button id="restart">–ó–∞–Ω–æ–≤–æ</button>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <div id="settingsModal">
    <div class="modal-content">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–∏</h3>
      <h4>–°–ø–∏—Å–æ–∫ 1</h4>
      <textarea id="listInput1"></textarea>
      <button id="saveBtn1">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="resetBtn1">–°–±—Ä–æ—Å–∏—Ç—å</button>

      <div class="divider"></div>
      <h4>–°–ø–∏—Å–æ–∫ 2</h4>
      <textarea id="listInput2"></textarea>
      <button id="saveBtn2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="resetBtn2">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
  </div>

  <!-- –©–µ–ª—á–æ–∫ -->
  <audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<script>
const defaultItems1 = ["üçé –Ø–±–ª–æ–∫–æ", "üçå –ë–∞–Ω–∞–Ω", "üçá –í–∏–Ω–æ–≥—Ä–∞–¥", "üçä –ê–ø–µ–ª—å—Å–∏–Ω", "üçâ –ê—Ä–±—É–∑"];
const defaultItems2 = ["üöó –ú–∞—à–∏–Ω–∞", "üö≤ –í–µ–ª–æ—Å–∏–ø–µ–¥", "‚úàÔ∏è –°–∞–º–æ–ª–µ—Ç", "üõ≥Ô∏è –ö–æ—Ä–∞–±–ª—å", "üöå –ê–≤—Ç–æ–±—É—Å"];

let items1 = JSON.parse(localStorage.getItem("slotItems1")) || [...defaultItems1];
let items2 = JSON.parse(localStorage.getItem("slotItems2")) || [...defaultItems2];
let choice1 = 0, choice2 = 0;

const slot1 = document.getElementById("slot1");
const slot2 = document.getElementById("slot2");
const wrapper1 = document.getElementById("wrapper1");
const wrapper2 = document.getElementById("wrapper2");
const resultText = document.getElementById("resultText");
const clickSound = document.getElementById("clickSound");

function renderSlot(container, items){
  container.innerHTML = '';
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'slot-item';
    div.textContent = item;
    container.appendChild(div);
  });
}

function highlightSlot(container){
  const items = Array.from(container.children);
  const center = container.clientHeight / 2;
  let closestIdx = 0, minDist = Infinity;
  items.forEach((el, idx) => {
    const dist = Math.abs((el.offsetTop + el.offsetHeight/2) - center);
    el.classList.remove('active');
    if (dist < minDist) { minDist = dist; closestIdx = idx; }
  });
  items[closestIdx].classList.add('active');
  return closestIdx;
}

function animateRandomChoice(wrapper, container, items) {
  const randomIdx = Math.floor(Math.random() * items.length);
  const el = container.children[randomIdx];
  const target = el.offsetTop - wrapper.clientHeight/2 + el.offsetHeight/2;

  wrapper.scrollTo({ top: target + Math.random()*50 - 25, behavior: 'smooth' });
  setTimeout(() => {
    wrapper.scrollTo({ top: target, behavior: 'smooth' });
    setTimeout(() => {
      highlightSlot(container);
      clickSound.currentTime = 0;
      clickSound.play();
    }, 300);
  }, 500);
  return randomIdx;
}

function showScreen(id){
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

renderSlot(slot1, items1);
renderSlot(slot2, items2);

wrapper1.addEventListener('scroll', () => highlightSlot(slot1));
wrapper2.addEventListener('scroll', () => highlightSlot(slot2));

wrapper1.addEventListener('touchend', () => {
  setTimeout(() => {
    choice1 = animateRandomChoice(wrapper1, slot1, items1);
    setTimeout(() => showScreen('screen2'), 1000);
  }, 150);
});

wrapper2.addEventListener('touchend', () => {
  setTimeout(() => {
    choice2 = animateRandomChoice(wrapper2, slot2, items2);
    setTimeout(() => {
      resultText.textContent = items1[choice1] + " + " + items2[choice2];
      showScreen('screen3');
    }, 1000);
  }, 150);
});

document.getElementById('restart').onclick = () => showScreen('screen1');

// --- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
const modal = document.getElementById('settingsModal');
const listInput1 = document.getElementById('listInput1');
const listInput2 = document.getElementById('listInput2');

document.getElementById('settingsBtn').onclick = () => {
  listInput1.value = items1.join("\n");
  listInput2.value = items2.join("\n");
  modal.style.display = "flex";
};
modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = "none"; });

document.getElementById('saveBtn1').onclick = () => {
  items1 = listInput1.value.split("\n").filter(v => v.trim());
  localStorage.setItem("slotItems1", JSON.stringify(items1));
  renderSlot(slot1, items1);
};
document.getElementById('saveBtn2').onclick = () => {
  items2 = listInput2.value.split("\n").filter(v => v.trim());
  localStorage.setItem("slotItems2", JSON.stringify(items2));
  renderSlot(slot2, items2);
};
document.getElementById('resetBtn1').onclick = () => {
  items1 = [...defaultItems1];
  localStorage.removeItem("slotItems1");
  renderSlot(slot1, items1);
};
document.getElementById('resetBtn2').onclick = () => {
  items2 = [...defaultItems2];
  localStorage.removeItem("slotItems2");
  renderSlot(slot2, items2);
};
</script>
</body>
</html>
