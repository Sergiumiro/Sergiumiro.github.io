<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>–ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏ üé≤</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
:root{
  --picker-max-width:640px;
  --item-height:64px;
  --blue:#007aff;
  --light-bg:#f5f8ff;
  --white:#fff;
  --shadow:0 8px 24px rgba(0,0,0,0.08);
  --radius:14px;
}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--light-bg);color:#111;display:flex;flex-direction:column;height:100vh;overflow:hidden;}
header{display:flex;justify-content:flex-end;align-items:center;padding:12px 16px;background:var(--white);border-bottom:1px solid #e5e5e5;box-shadow:0 4px 12px rgba(0,0,0,0.08);z-index:5;}
#settingsBtn{font-size:22px;cursor:pointer;}
.screen{flex:1;display:none;align-items:center;justify-content:center;flex-direction:column;padding:20px;text-align:center;animation:fadein 0.4s ease;}
.screen.active{display:flex;}
@keyframes fadein{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
h2{font-size:22px;margin-bottom:20px;}
.picker{width:100%;max-width:var(--picker-max-width);height:320px;perspective:1800px;position:relative;overflow:hidden;background:var(--white);border-radius:var(--radius);box-shadow:0 8px 24px rgba(0,0,0,0.08);touch-action:none;}
.wheel{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotateX(0deg);transform-style:preserve-3d;width:100%;height:100%;}
.item{position:absolute;top:50%;left:0;width:100%;height:var(--item-height);margin-top:calc(var(--item-height)/-2);transform-style:preserve-3d;}
.item-inner{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:18px;color:#555;padding:0 18px;box-sizing:border-box;text-align:center;white-space:normal;line-height:1.3;transform-style:preserve-3d;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.1);}100%{transform:scale(1);}}
.item.active .item-inner{font-size:20px;font-weight:600;color:var(--blue);animation:pulse 0.6s ease 2;}
.picker::after{content:"";position:absolute;left:0;right:0;top:50%;height:var(--item-height);margin-top:calc(var(--item-height)/-2);border-top:2px solid rgba(0,122,255,0.2);border-bottom:2px solid rgba(0,122,255,0.2);pointer-events:none;}
#resultCard{background:#fff;padding:20px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,0.1);text-align:center;max-width:500px;margin:0 auto;}
#resultText{font-size:24px;font-weight:600;margin-top:10px;word-break:break-word;line-height:1.4;}
button{margin-top:18px;padding:12px 22px;border-radius:10px;border:0;font-size:16px;cursor:pointer;background:var(--blue);color:#fff;box-shadow:0 4px 14px rgba(0,122,255,0.3);transition:background .2s, transform .1s;}
button:hover{background:#005fe0;}
button:active{transform:scale(0.98);}
.random-btn{margin-top:14px;background:#fff;color:var(--blue);border:1px solid var(--blue);box-shadow:none;}
.random-btn:hover{background:rgba(0,122,255,0.06);}
#shareBtn{background:#0088cc;box-shadow:0 4px 14px rgba(0,136,204,0.3);}
#shareBtn:hover{background:#0077b5;}
#settingsModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:10;}
.modal-content{background:#fff;padding:20px;width:360px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.2);overflow:auto;}
textarea{width:100%;height:100px;border:1px solid #ddd;border-radius:8px;padding:8px;font-family:inherit;}
.divider{margin:16px 0;border-top:1px solid #eee;}
</style>
</head>
<body>
<header><div id="settingsBtn">‚öôÔ∏è</div></header>

<div class="screen active" id="screen1">
  <h2>–í—ã–±–µ—Ä–∏ –º–µ—Å—Ç–æ</h2>
  <div class="picker" id="picker1"><div class="wheel" id="wheel1"></div></div>
  <button class="random-btn" id="random1">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä</button>
</div>

<div class="screen" id="screen2">
  <h2>–í—ã–±–µ—Ä–∏ –∑–∞–Ω—è—Ç–∏–µ</h2>
  <div class="picker" id="picker2"><div class="wheel" id="wheel2"></div></div>
  <button class="random-btn" id="random2">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä</button>
</div>

<div class="screen" id="screen3">
  <div id="resultCard">
    <h3>–ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏</h3>
    <div id="resultText"></div>
  </div>
  <button id="shareBtn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram</button>
  <button id="restart">üîÑ –ó–∞–Ω–æ–≤–æ</button>
</div>

<div id="settingsModal">
  <div class="modal-content">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–∏</h3>
    <h4>–°–ø–∏—Å–æ–∫ –º–µ—Å—Ç</h4>
    <textarea id="listInput1"></textarea>
    <button id="saveBtn1">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="resetBtn1">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
    <div class="divider"></div>
    <h4>–°–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç–∏–π</h4>
    <textarea id="listInput2"></textarea>
    <button id="saveBtn2">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="resetBtn2">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>
</div>

<audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
const defaultItems1=["","üåá –ö—Ä—ã—à–∞","üå≥ –ü–∞—Ä–∫","üåä –ú–æ—Ä–µ","üåÜ –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥","üèûÔ∏è –õ–µ—Å","üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω","üé¢ –ü–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤","üèñÔ∏è –ü–ª—è–∂","üè∞ –ó–∞–º–æ–∫"];
const defaultItems2=["","üö∂ –ü—Ä–æ–≥—É–ª–∫–∞","üì∏ –§–æ—Ç–æ","üç∑ –£–∂–∏–Ω","üé¨ –ö–∏–Ω–æ","üé∂ –ö–æ–Ω—Ü–µ—Ä—Ç","üçï –ü–∏–∫–Ω–∏–∫","üéÆ –ò–≥—Ä—ã","üß∫ –ó–∞–≤—Ç—Ä–∞–∫","üïØÔ∏è –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä"];
let items1=JSON.parse(localStorage.getItem("slotItems1"))||[...defaultItems1];
let items2=JSON.parse(localStorage.getItem("slotItems2"))||[...defaultItems2];
const clickSound=document.getElementById("clickSound");

function buildWheel(wheel,items){
  wheel.innerHTML="";
  const radius=140;
  const angleStep=360/items.length;
  items.forEach((text,i)=>{
    const el=document.createElement("div");
    el.className="item";
    const angle=i*angleStep;
    el.style.transform=`rotateX(${angle}deg) translateZ(${radius}px)`;
    const inner=document.createElement("div");
    inner.className="item-inner";
    inner.style.transform=`rotateX(${-angle}deg)`;
    inner.textContent=text;
    el.appendChild(inner);
    wheel.appendChild(el);
  });
  wheel.dataset.rotation="0";
}

function spinWheel(wheel,velocity,items,onFinish,targetIndex=null){
  let rotation=parseFloat(wheel.dataset.rotation||"0");const angleStep=360/items.length;
  if(targetIndex!==null){
    const extraSpins=3+Math.random()*2;
    const finalAngle=-targetIndex*angleStep-extraSpins*360;
    let frame=0,totalFrames=80,startAngle=rotation;
    function animate(){
      frame++;
      const progress=frame/totalFrames;
      const ease=1-Math.pow(1-progress,3);
      const current=startAngle+(finalAngle-startAngle)*ease;
      wheel.style.transform=`translate(-50%,-50%) rotateX(${current}deg)`;
      if(frame%8===0){clickSound.currentTime=0;clickSound.play();}
      if(frame<totalFrames) requestAnimationFrame(animate);
      else{wheel.dataset.rotation=current;Array.from(wheel.children).forEach((el,i)=>el.classList.toggle("active",i===targetIndex));onFinish?.(targetIndex);}
    }
    animate(); return;
  }
  const damping=0.97;
  function animate(){
    velocity*=damping;rotation+=velocity;wheel.style.transform=`translate(-50%,-50%) rotateX(${rotation}deg)`;wheel.dataset.rotation=rotation;
    if(Math.abs(velocity)>0.3) requestAnimationFrame(animate);
    else{
      const index=Math.round(-rotation/angleStep)%items.length;
      const fixedIndex=(index+items.length)%items.length;
      const finalAngle=-fixedIndex*angleStep;
      wheel.style.transform=`translate(-50%,-50%) rotateX(${finalAngle}deg)`;
      Array.from(wheel.children).forEach((el,i)=>el.classList.toggle("active",i===fixedIndex));
      onFinish?.(fixedIndex);
    }
  }
  animate();
}

function enablePicker(picker,wheel,items,onSelect){
  let startY=0,lastY=0,velocity=0,lastTime=0,dragging=false,rotation=0;
  picker.addEventListener("touchstart",e=>{dragging=true; startY=lastY=e.touches[0].clientY; lastTime=performance.now();});
  picker.addEventListener("touchmove",e=>{
    if(!dragging) return;
    const y=e.touches[0].clientY;
    const dy=y-lastY;
    rotation-=dy*0.6;
    wheel.style.transform=`translate(-50%,-50%) rotateX(${rotation}deg)`;
    velocity=dy/(performance.now()-lastTime)*15;
    lastY=y; lastTime=performance.now();
  });
  picker.addEventListener("touchend",()=>{dragging=false; spinWheel(wheel,velocity,items,onSelect);});
}

function showScreen(id){document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));document.getElementById(id).classList.add("active");}

const wheel1=document.getElementById("wheel1");
const wheel2=document.getElementById("wheel2");
buildWheel(wheel1,items1);
buildWheel(wheel2,items2);

let selected1=0;
enablePicker(document.getElementById("picker1"),wheel1,items1,i=>{selected1=i; showScreen("screen2");});
enablePicker(document.getElementById("picker2"),wheel2,items2,i=>{
  const selected2=i;
  const result=`${items1[selected1]||"‚ùì"} ‚Äî ${items2[selected2]||"‚ùì"}`;
  document.getElementById("resultText").textContent=result;
  showScreen("screen3");
});

document.getElementById("restart").onclick=()=>{showScreen("screen1");};

document.getElementById("random1").onclick=()=>{const i=Math.floor(Math.random()*(items1.length-1))+1; spinWheel(wheel1,0,items1,idx=>{selected1=idx; showScreen("screen2");},i);};
document.getElementById("random2").onclick=()=>{const i=Math.floor(Math.random()*(items2.length-1))+1; spinWheel(wheel2,0,items2,idx=>{document.getElementById("resultText").textContent=`${items1[selected1]} ‚Äî ${items2[idx]}`; showScreen("screen3");},i);};

// ‚öôÔ∏è –ú–æ–¥–∞–ª–∫–∞
const modal=document.getElementById("settingsModal");
const listInput1=document.getElementById("listInput1");
const listInput2=document.getElementById("listInput2");
document.getElementById("settingsBtn").onclick=()=>{modal.style.display="flex"; listInput1.value=items1.join("\n"); listInput2.value=items2.join("\n");};
modal.onclick=e=>{if(e.target===modal) modal.style.display="none";};
document.getElementById("saveBtn1").onclick=()=>{items1=listInput1.value.split("\n").map(x=>x.trim());localStorage.setItem("slotItems1",JSON.stringify(items1)); buildWheel(wheel1,items1);};
document.getElementById("saveBtn2").onclick=()=>{items2=listInput2.value.split("\n").map(x=>x.trim());localStorage.setItem("slotItems2",JSON.stringify(items2)); buildWheel(wheel2,items2);};
document.getElementById("resetBtn1").onclick=()=>{items1=[...defaultItems1];localStorage.removeItem("slotItems1");buildWheel(wheel1,items1);};
document.getElementById("resetBtn2").onclick=()=>{items2=[...defaultItems2];localStorage.removeItem("slotItems2");buildWheel(wheel2,items2);};

// –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram" —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç–∏–Ω–∫—É
document.getElementById("shareBtn").onclick=()=>{
  const card=document.getElementById("resultCard");
  html2canvas(card).then(canvas=>{
    const imgData=canvas.toDataURL("image/png");
    const win=window.open("", "_blank");
    win.document.write("<p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Telegram:</p>");
    win.document.write(`<img src="${imgData}" style="max-width:100%"/>`);
  });
};
</script>
</body>
</html>
