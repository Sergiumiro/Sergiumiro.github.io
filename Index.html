<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏ üé≤</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --primary: #6a11cb;
      --secondary: #2575fc;
      --accent: #ff6b6b;
      --light-bg: #f8f9ff;
      --card-bg: #ffffff;
      --text: #2d3748;
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
      --radius: 20px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--light-bg), #e0e7ff);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    header {
      display: flex;
      justify-content: flex-end;
      padding: 16px 20px;
      z-index: 10;
    }

    #settingsBtn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      background: var(--card-bg);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    #settingsBtn:hover {
      transform: rotate(30deg);
      background: var(--primary);
      color: white;
    }

    .screen {
      flex: 1;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      max-width: 100%;
      animation: fadeIn 0.5s ease forwards;
    }

    .screen.active {
      display: flex;
      opacity: 0;
      animation: slideIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @keyframes slideIn {
      0% { 
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      100% { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    h2 {
      font-size: 28px;
      margin-bottom: 30px;
      text-align: center;
      color: var(--primary);
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .picker {
      width: 100%;
      max-width: 360px;
      height: 340px;
      perspective: 1800px;
      position: relative;
      overflow: hidden;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wheel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotateX(0deg);
      transform-style: preserve-3d;
      width: 100%;
      height: 100%;
    }

    .item {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 64px;
      margin-top: -32px;
      transform-style: preserve-3d;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .item.active {
      opacity: 1;
    }

    .item-inner {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      font-size: 18px;
      padding: 0 20px;
      text-align: center;
      white-space: normal;
      line-height: 1.4;
      color: #718096;
      font-weight: 500;
    }

    .item.active .item-inner {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
      text-shadow: 0 2px 4px rgba(106, 17, 203, 0.15);
      transform: scale(1.05);
      animation: pulse 0.8s ease 2;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .picker::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      height: 64px;
      margin-top: -32px;
      border-top: 3px solid rgba(106, 17, 203, 0.2);
      border-bottom: 3px solid rgba(106, 17, 203, 0.2);
      pointer-events: none;
      z-index: 2;
    }

    .picker::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, 
        rgba(255,255,255,0.9) 0%, 
        rgba(255,255,255,0.6) 30%, 
        rgba(255,255,255,0.6) 70%, 
        rgba(255,255,255,0.9) 100%);
      z-index: 1;
      border-radius: var(--radius);
      pointer-events: none;
    }

    #resultCard {
      background: var(--card-bg);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
      max-width: 480px;
      width: 100%;
      margin: 20px 0;
      border: 1px solid rgba(106, 17, 203, 0.1);
    }

    #resultText {
      font-size: 26px;
      font-weight: 700;
      margin: 20px 0;
      color: var(--primary);
      line-height: 1.4;
      word-break: break-word;
      text-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    button {
      padding: 14px 28px;
      border-radius: 16px;
      border: 0;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 10px 0;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 30px rgba(106, 17, 203, 0.25);
    }

    button:active {
      transform: translateY(1px);
    }

    .primary-btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .secondary-btn {
      background: var(--card-bg);
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    #shareBtn {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
    }

    #restart {
      background: transparent;
      color: #a0aec0;
      border: 2px solid #e2e8f0;
    }

    #restart:hover {
      background: #f7fafc;
      color: var(--primary);
    }

    #settingsModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 500px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      animation: modalAppear 0.4s ease forwards;
    }

    @keyframes modalAppear {
      0% { 
        opacity: 0; 
        transform: scale(0.8) translateY(20px);
      }
      100% { 
        opacity: 1; 
        transform: scale(1) translateY(0);
      }
    }

    h3 {
      color: var(--primary);
      margin-bottom: 20px;
      font-size: 22px;
      text-align: center;
    }

    h4 {
      margin: 20px 0 10px;
      color: #4a5568;
      font-size: 16px;
    }

    textarea {
      width: 100%;
      height: 120px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 14px;
      font-family: inherit;
      font-size: 16px;
      resize: vertical;
      transition: var(--transition);
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.2);
    }

    .divider {
      margin: 25px 0;
      border: 0;
      height: 1px;
      background: linear-gradient(to right, transparent, #e2e8f0, transparent);
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .btn-group button {
      flex: 1;
      min-width: 120px;
    }

    @media (max-width: 480px) {
      .picker {
        height: 300px;
      }
      
      h2 {
        font-size: 24px;
      }
      
      #resultText {
        font-size: 22px;
      }
      
      .modal-content {
        padding: 20px;
        margin: 0 15px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div id="settingsBtn">‚öôÔ∏è</div>
  </header>

  <div class="screen active" id="screen1">
    <h2>–í—ã–±–µ—Ä–∏ –º–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏</h2>
    <div class="picker" id="picker1">
      <div class="wheel" id="wheel1"></div>
    </div>
    <button class="secondary-btn" id="random1">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä</button>
  </div>

  <div class="screen" id="screen2">
    <h2>–í—ã–±–µ—Ä–∏ –∑–∞–Ω—è—Ç–∏–µ</h2>
    <div class="picker" id="picker2">
      <div class="wheel" id="wheel2"></div>
    </div>
    <button class="secondary-btn" id="random2">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä</button>
  </div>

  <div class="screen" id="screen3">
    <div id="resultCard">
      <h3>‚ú® –ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏</h3>
      <div id="resultText"></div>
    </div>
    <button class="primary-btn" id="shareBtn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram</button>
    <button id="restart">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  </div>

  <div id="settingsModal">
    <div class="modal-content">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–∏</h3>
      
      <h4>–°–ø–∏—Å–æ–∫ –º–µ—Å—Ç</h4>
      <textarea id="listInput1"></textarea>
      <div class="btn-group">
        <button class="primary-btn" id="saveBtn1">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="secondary-btn" id="resetBtn1">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
      
      <div class="divider"></div>
      
      <h4>–°–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç–∏–π</h4>
      <textarea id="listInput2"></textarea>
      <div class="btn-group">
        <button class="primary-btn" id="saveBtn2">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="secondary-btn" id="resetBtn2">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

  <script>
    const defaultItems1 = ["", "üåá –ö—Ä—ã—à–∞", "üå≥ –ü–∞—Ä–∫", "üåä –ú–æ—Ä–µ", "üåÜ –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥", "üèûÔ∏è –õ–µ—Å", "üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω", "üé¢ –ü–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤", "üèñÔ∏è –ü–ª—è–∂", "üè∞ –ó–∞–º–æ–∫"];
    const defaultItems2 = ["", "üö∂ –ü—Ä–æ–≥—É–ª–∫–∞", "üì∏ –§–æ—Ç–æ", "üç∑ –£–∂–∏–Ω", "üé¨ –ö–∏–Ω–æ", "üé∂ –ö–æ–Ω—Ü–µ—Ä—Ç", "üçï –ü–∏–∫–Ω–∏–∫", "üéÆ –ò–≥—Ä—ã", "üß∫ –ó–∞–≤—Ç—Ä–∞–∫", "üïØÔ∏è –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä"];
    
    let items1 = JSON.parse(localStorage.getItem("slotItems1")) || [...defaultItems1];
    let items2 = JSON.parse(localStorage.getItem("slotItems2")) || [...defaultItems2];
    
    const clickSound = document.getElementById("clickSound");

    function buildWheel(wheel, items) {
      wheel.innerHTML = "";
      const radius = 140;
      const angleStep = 360 / items.length;
      
      items.forEach((text, i) => {
        const el = document.createElement("div");
        el.className = "item";
        const angle = i * angleStep;
        el.style.transform = `rotateX(${angle}deg) translateZ(${radius}px)`;
        
        const inner = document.createElement("div");
        inner.className = "item-inner";
        inner.textContent = text;
        el.appendChild(inner);
        wheel.appendChild(el);
      });
      
      wheel.dataset.rotation = "0";
    }

    function spinWheel(wheel, velocity, items, onFinish, targetIndex = null) {
      let rotation = parseFloat(wheel.dataset.rotation || "0");
      const angleStep = 360 / items.length;
      
      if (targetIndex !== null) {
        const extraSpins = 3 + Math.random() * 2;
        const finalAngle = -targetIndex * angleStep - extraSpins * 360;
        let frame = 0, totalFrames = 80, startAngle = rotation;
        
        function animate() {
          frame++;
          const progress = frame / totalFrames;
          const ease = 1 - Math.pow(1 - progress, 3);
          const current = startAngle + (finalAngle - startAngle) * ease;
          
          wheel.style.transform = `translate(-50%,-50%) rotateX(${current}deg)`;
          
          if (frame % 8 === 0) {
            clickSound.currentTime = 0;
            clickSound.play();
          }
          
          if (frame < totalFrames) {
            requestAnimationFrame(animate);
          } else {
            wheel.dataset.rotation = current;
            Array.from(wheel.children).forEach((el, i) => 
              el.classList.toggle("active", i === targetIndex)
            );
            onFinish?.(targetIndex);
          }
        }
        animate();
        return;
      }
      
      const damping = 0.97;
      function animate() {
        velocity *= damping;
        rotation += velocity;
        wheel.style.transform = `translate(-50%,-50%) rotateX(${rotation}deg)`;
        wheel.dataset.rotation = rotation;
        
        if (Math.abs(velocity) > 0.3) {
          requestAnimationFrame(animate);
        } else {
          const index = Math.round(-rotation / angleStep) % items.length;
          const fixedIndex = (index + items.length) % items.length;
          const finalAngle = -fixedIndex * angleStep;
          
          wheel.style.transform = `translate(-50%,-50%) rotateX(${finalAngle}deg)`;
          Array.from(wheel.children).forEach((el, i) => 
            el.classList.toggle("active", i === fixedIndex)
          );
          onFinish?.(fixedIndex);
        }
      }
      animate();
    }

    function enablePicker(picker, wheel, items, onSelect) {
      let startY = 0, lastY = 0, velocity = 0, lastTime = 0;
      let dragging = false, rotation = 0;
      
      picker.addEventListener("touchstart", e => {
        dragging = true;
        startY = lastY = e.touches[0].clientY;
        lastTime = performance.now();
      });
      
      picker.addEventListener("touchmove", e => {
        if (!dragging) return;
        const y = e.touches[0].clientY;
        const dy = y - lastY;
        rotation -= dy * 0.6;
        wheel.style.transform = `translate(-50%,-50%) rotateX(${rotation}deg)`;
        velocity = dy / (performance.now() - lastTime) * 15;
        lastY = y;
        lastTime = performance.now();
      });
      
      picker.addEventListener("touchend", () => {
        dragging = false;
        spinWheel(wheel, velocity, items, onSelect);
      });
      
      // Desktop support
      let isMouseDown = false;
      
      picker.addEventListener("mousedown", e => {
        isMouseDown = true;
        startY = lastY = e.clientY;
        lastTime = performance.now();
      });
      
      window.addEventListener("mousemove", e => {
        if (!isMouseDown) return;
        const y = e.clientY;
        const dy = y - lastY;
        rotation -= dy * 0.6;
        wheel.style.transform = `translate(-50%,-50%) rotateX(${rotation}deg)`;
        velocity = dy / (performance.now() - lastTime) * 15;
        lastY = y;
        lastTime = performance.now();
      });
      
      window.addEventListener("mouseup", () => {
        if (isMouseDown) {
          isMouseDown = false;
          spinWheel(wheel, velocity, items, onSelect);
        }
      });
    }

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(s => 
        s.classList.remove("active")
      );
      document.getElementById(id).classList.add("active");
    }

    const wheel1 = document.getElementById("wheel1");
    const wheel2 = document.getElementById("wheel2");
    
    buildWheel(wheel1, items1);
    buildWheel(wheel2, items2);

    let selected1 = 0;
    
    enablePicker(
      document.getElementById("picker1"), 
      wheel1, 
      items1, 
      i => { 
        selected1 = i; 
        showScreen("screen2"); 
      }
    );
    
    enablePicker(
      document.getElementById("picker2"), 
      wheel2, 
      items2, 
      i => {
        const selected2 = i;
        const result = `${items1[selected1] || "‚ùì"} ‚Äî ${items2[selected2] || "‚ùì"}`;
        document.getElementById("resultText").textContent = result;
        showScreen("screen3");
      }
    );

    document.getElementById("restart").onclick = () => {
      showScreen("screen1");
    };

    document.getElementById("random1").onclick = () => {
      const i = Math.floor(Math.random() * (items1.length - 1)) + 1;
      spinWheel(wheel1, 0, items1, idx => {
        selected1 = idx;
        showScreen("screen2");
      }, i);
    };

    document.getElementById("random2").onclick = () => {
      const i = Math.floor(Math.random() * (items2.length - 1)) + 1;
      spinWheel(wheel2, 0, items2, idx => {
        document.getElementById("resultText").textContent = 
          `${items1[selected1]} ‚Äî ${items2[idx]}`;
        showScreen("screen3");
      }, i);
    };

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const modal = document.getElementById("settingsModal");
    const listInput1 = document.getElementById("listInput1");
    const listInput2 = document.getElementById("listInput2");
    
    document.getElementById("settingsBtn").onclick = () => {
      modal.style.display = "flex";
      listInput1.value = items1.join("\n");
      listInput2.value = items2.join("\n");
    };
    
    modal.onclick = e => {
      if (e.target === modal) modal.style.display = "none";
    };
    
    document.getElementById("saveBtn1").onclick = () => {
      items1 = listInput1.value.split("\n").map(x => x.trim()).filter(x => x);
      items1 = ["", ...items1]; // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∞—á–∞–ª–æ
      localStorage.setItem("slotItems1", JSON.stringify(items1));
      buildWheel(wheel1, items1);
    };
    
    document.getElementById("saveBtn2").onclick = () => {
      items2 = listInput2.value.split("\n").map(x => x.trim()).filter(x => x);
      items2 = ["", ...items2]; // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∞—á–∞–ª–æ
      localStorage.setItem("slotItems2", JSON.stringify(items2));
      buildWheel(wheel2, items2);
    };
    
    document.getElementById("resetBtn1").onclick = () => {
      items1 = [...defaultItems1];
      localStorage.removeItem("slotItems1");
      buildWheel(wheel1, items1);
    };
    
    document.getElementById("resetBtn2").onclick = () => {
      items2 = [...defaultItems2];
      localStorage.removeItem("slotItems2");
      buildWheel(wheel2, items2);
    };

    // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram
    document.getElementById("shareBtn").onclick = () => {
      const card = document.getElementById("resultCard");
      html2canvas(card).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const win = window.open("", "_blank");
        win.document.write(`
          <html>
            <head><title>–ò–¥–µ—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏</title></head>
            <body style="display:flex;align-items:center;justify-content:center;">
              <div>
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Telegram:</p>
                <img src="${imgData}" style="max-width:100%;border-radius:12px;"/>
              </div>
            </body>
          </html>
        `);
      });
    };
  </script>
</body>
</html>
