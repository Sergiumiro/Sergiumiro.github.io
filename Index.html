<!doctype html>

<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Рулетка свидания</title>
  <style>
    :root {
      --bg: linear-gradient(180deg, #0f1723 0%, #0b1220 60%);
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.6);
      --border: rgba(255,255,255,0.08);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body {
      height:100%;margin:0;background:var(--bg);color:var(--text);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      -webkit-font-smoothing:antialiased;
    }
    .title {
      position:fixed;top:16px;left:16px;font-weight:600;font-size:18px;
    }
    #settingsBtn {
      position:fixed;top:12px;right:16px;background:transparent;border:0;color:var(--muted);font-size:22px;
    }
    .wheel-wrapper {
      width:90%;max-width:400px;position:relative;
    }
    .wheel {
      width:100%;height:260px;border-radius:16px;background:rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);box-shadow:0 8px 30px rgba(2,6,23,0.6);
      overflow:hidden;scrollbar-width:none;-ms-overflow-style:none;touch-action:pan-y;
    }
    .wheel::-webkit-scrollbar {display:none}
    .wheel-list {list-style:none;margin:0;padding:60px 0;width:100%}
    .wheel-list li {
      height:52px;line-height:52px;text-align:center;font-weight:600;white-space:nowrap;
      overflow:hidden;text-overflow:ellipsis;font-size:20px;
    }
    .wheel-overlay {
      position:absolute;left:12px;right:12px;pointer-events:none;display:flex;align-items:center;justify-content:center;height:100%;
    }
    .wheel-overlay::before {
      content:'';position:absolute;left:0;right:0;height:66px;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
    }
    .spin-btn {
      margin-top:20px;padding:12px 22px;border-radius:14px;border:0;background:rgba(255,255,255,0.06);
      color:var(--text);font-weight:700;font-size:18px;
    }
    .modal {position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:24px;z-index:50;}
    .modal.show {display:flex;}
    .modal .card {
      width:100%;max-width:420px;background:rgba(10,12,16,0.9);border-radius:16px;padding:16px;box-shadow:0 12px 40px rgba(0,0,0,0.6);
    }
    .list-edit {max-height:260px;overflow:auto;padding:6px;border-radius:10px;background:rgba(255,255,255,0.02)}
    .row {display:flex;gap:8px;padding:6px}
    .row input {flex:1;padding:8px;border-radius:10px;border:0;background:rgba(255,255,255,0.05);color:var(--text)}
    .row button {padding:8px 10px;border-radius:10px;border:0}
    #addItemBtn {margin-top:8px;width:100%;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.06);color:var(--text)}
  </style>
</head>
<body>
  <div class="title">Рулетка свидания</div>
  <button id="settingsBtn">⚙️</button>  <div class="wheel-wrapper">
    <div id="wheel" class="wheel" tabindex="0">
      <ul class="wheel-list"></ul>
    </div>
    <div class="wheel-overlay"></div>
  </div>
  <button class="spin-btn">Крутить</button>  <div class="modal" id="settingsModal">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <strong>Настройки списка</strong>
        <button id="closeSettings">✕</button>
      </div>
      <div class="list-edit" id="editorList"></div>
      <input id="newItemInput" placeholder="Новый элемент" />
      <button id="addItemBtn">Добавить</button>
    </div>
  </div>  <script>
  const DEFAULT_ITEMS = ["Кафе у реки","Городской парк","Кинотеатр","Ресторан","Крыша с видом","Музей","Прогулка по набережной","Пикник"];
  const STORAGE_KEY = 'date_picker_items_v1';

  function loadItems(){
    try{const raw=localStorage.getItem(STORAGE_KEY);if(raw) return JSON.parse(raw);}catch(e){}
    return [...DEFAULT_ITEMS];
  }
  function saveItems(list){localStorage.setItem(STORAGE_KEY, JSON.stringify(list));}

  let items = loadItems();
  const wheel = document.getElementById('wheel');
  const listEl = wheel.querySelector('.wheel-list');
  const spinBtn = document.querySelector('.spin-btn');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsModal = document.getElementById('settingsModal');
  const closeSettings = document.getElementById('closeSettings');
  const editorList = document.getElementById('editorList');
  const newItemInput = document.getElementById('newItemInput');
  const addItemBtn = document.getElementById('addItemBtn');

  let spinning = false;
  let wakeLock = null;

  function renderWheel(){
    listEl.innerHTML='';
    const full = [...items, ...items, ...items];
    full.forEach(it=>{const li=document.createElement('li');li.textContent=it;listEl.appendChild(li);});
    const first=listEl.querySelector('li');
    if(first){const h=first.getBoundingClientRect().height;const top=(wheel.clientHeight-h)/2;wheel.scrollTop=items.length*h-top;}
  }

  async function startSpin(){
    if(spinning||items.length===0)return;
    spinning=true;
    await requestWakeLock();
    const h=listEl.querySelector('li').getBoundingClientRect().height;
    const top=(wheel.clientHeight-h)/2;
    const current=wheel.scrollTop;
    const rand=Math.floor(Math.random()*items.length);
    const spins=3+Math.floor(Math.random()*3);
    const targetIndex=items.length*(1+spins)+rand;
    const target=targetIndex*h-top;
    const dur=2000;
    await animateScroll(wheel,current,target,dur);
    wheel.scrollTop=items.length*h+rand*h-top;
    spinning=false;
    releaseWakeLock();
  }

  function animateScroll(container,from,to,duration){
    return new Promise(resolve=>{
      const start=performance.now();
      function step(now){
        const t=Math.min(1,(now-start)/duration);
        const ease=1-Math.pow(1-t,3);
        container.scrollTop=from+(to-from)*ease;
        if(t<1)requestAnimationFrame(step);else resolve();
      }
      requestAnimationFrame(step);
    });
  }

  async function requestWakeLock(){if('wakeLock' in navigator){try{wakeLock=await navigator.wakeLock.request('screen');}catch(e){}}}
  function releaseWakeLock(){if(wakeLock){try{wakeLock.release();}catch(e){}wakeLock=null;}}

  function renderEditor(){
    editorList.innerHTML='';
    items.forEach((it,idx)=>{
      const row=document.createElement('div');row.className='row';
      const input=document.createElement('input');input.value=it;input.onchange=()=>{items[idx]=input.value;saveItems(items);renderWheel();};
      const del=document.createElement('button');del.textContent='✕';del.onclick=()=>{items.splice(idx,1);saveItems(items);renderEditor();renderWheel();};
      row.append(input,del);editorList.append(row);
    });
  }

  addItemBtn.onclick=()=>{const val=newItemInput.value.trim();if(!val)return;items.push(val);saveItems(items);newItemInput.value='';renderEditor();renderWheel();};

  settingsBtn.onclick=()=>{settingsModal.classList.add('show');renderEditor();};
  closeSettings.onclick=()=>settingsModal.classList.remove('show');

  spinBtn.onclick=()=>{if(!spinning)startSpin();};

  renderWheel();
  </script></body>
</html>
